# 共通・銀行・倉庫マスタ 仕様概要

## 1. 本書の位置づけ
本書は、ProcureERP（購買管理業務SaaS）における  
**共通・基盤系マスタ（通貨／銀行／支払先口座／倉庫）** の仕様概要を定義するものである。

本仕様は、これまでの設計検討・QA壁打ちを経て確定した内容を  
共通・銀行・倉庫マスタ 仕様として以下に記す。

---

## 2. 対象プロダクト概要
- プロダクト名：ProcureERP
- 種別：購買管理業務SaaS
- 対象業種：製造業・卸業を含む中堅企業
- マルチテナント構成：1テナント = 1自社法人
- RLS境界：tenant_id
- 正本PK：UUID
- 業務コード：人間可読用途（表示・検索・帳票・CSV・外部連携）

---

## 3. 設計思想（不変）
- ERPとして正しいが、SaaSとして過度に重くしない
- MVPでは「軽すぎず・重すぎず」
- 将来拡張（会計／物流／一括請求）を壊さず見据える
- 物理削除は禁止、論理無効化（is_active=false）を原則とする
- 住所は text 1本では持たず、日本住所前提で分割保持する

---

## 4. 本仕様に含まれるマスタ
本仕様で定義するエンティティは以下とする。

### 4.1 金融・決済系
- 通貨マスタ（Currency）
- 銀行マスタ（Bank）
- 銀行支店マスタ（BankBranch）
- 支払先口座（PayeeBankAccount）

### 4.2 物流・拠点系
- 倉庫グループマスタ（WarehouseGroup）- **MVPではエンティティのみ**
- 倉庫マスタ（Warehouse）- **MVP対象**

※ 在庫管理はV2以降とし、本仕様では在庫テーブルは作成しない。

---

## 4.3 倉庫マスタ詳細仕様（MVP確定）

### 用途
- **自社倉庫**：社内の受入・保管場所の管理
- **在庫管理場所**：V2以降の在庫管理の基盤
- **入荷時の受入先**：発注・入荷時に受入倉庫を指定

※ 発注書の納入先（直送先）は `ship_to` マスタを使用

### 住所形式
住所は他マスタと揃えて**分割形式**で保持：
- postal_code（郵便番号）
- prefecture（都道府県）
- city（市区町村）
- address_1（住所1）
- address_2（住所2）
- phone_number（電話番号）

### 検索用カナ
- warehouse_name_kana：検索用（半角カナ）

### 既定受入倉庫
- is_default_receiving = true は**テナントにつき1倉庫のみ**
- 部分一意制約で保証

### 表示順
- display_order：表示順（小さい順に表示）

### 倉庫グループ（MVP外）
- warehouse_group_id は **nullable**
- 倉庫グループなしでも倉庫登録可能
- 倉庫グループ管理UIはV2以降

---

## 5. テナントスコープ方針
| マスタ | テナントスコープ |
|------|----------------|
| Currency | 全テナント共通（参照専用） |
| Bank | テナント別（tenant_idあり） |
| BankBranch | テナント別（tenant_idあり） |
| PayeeBankAccount | テナント別 |
| WarehouseGroup | テナント別 |
| Warehouse | テナント別 |

---

## 6. 発注・仕入との関係（MVP）
- 倉庫は **発注（PO）／受入（GR）で指定可能**
- 在庫数量管理は行わない
- POとGRは「予定」と「実績」を分離して保持する

---

## 7. 今後の拡張前提（参考）
- 在庫残高・入出庫管理（V2）
- 倉庫グループ階層化
- 銀行・支店マスタの全銀協データ取り込み
- 支払条件マスタ化（payment_terms）

以上。
