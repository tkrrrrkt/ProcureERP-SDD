# カテゴリ・セグメント（軸と値） 仕様概要

## 1. 本書の位置づけ
本書は、ProcureERP における分類・グルーピング・分析のための
「カテゴリ（軸）」「セグメント（軸の値）」および
主要マスタ（品目・取引先・仕入先拠点）への紐づけ仕様を定義する。

本仕様は、設計検討およびQA壁打ちを経て確定した内容を
仕様概要とする。

---

## 2. 用語定義（確定）
- カテゴリ（CategoryAxis）：分類・分析の「軸（Axis / Dimension）」
- セグメント（Segment）：カテゴリ（軸）に紐づく「値（Member）」
- 割当（SegmentAssignment）：任意のエンティティに、カテゴリ（軸）とセグメント（値）を付与すること

---

## 3. 設計方針（確定）

### 3.1 カテゴリ（軸）はテナントが自由に作成可能
- カテゴリ（軸）はテナント単位で自由に作成できる。
- ただし、カテゴリ（軸）は「対象マスタ種別」を持ち、対象は1種別に限定する。

### 3.2 1カテゴリ（軸）は1マスタ種別専用
カテゴリ（軸）は以下の対象マスタ種別のうち、いずれか1つに専用として定義される。
- ITEM（品目）
- PARTY（取引先法人）
- SUPPLIER_SITE（仕入先拠点）

カテゴリ（軸）の他マスタ種別への流用は禁止する。

### 3.3 マスタ種別ごとにカテゴリ（軸）は複数作成可能
- 品目用カテゴリ（軸）は複数作成できる。
- 取引先用カテゴリ（軸）は複数作成できる。
- 仕入先拠点用カテゴリ（軸）は複数作成できる。

### 3.4 階層は品目カテゴリのみ
- 階層（親子）を持てるのは「ITEM（品目）対象のカテゴリ（軸）」のみ。
- PARTY / SUPPLIER_SITE 対象のカテゴリ（軸）では階層を持たない。

### 3.5 紐づけは「1軸につき1値」
- 任意のエンティティに対して、1カテゴリ（軸）につき付与できるセグメント（値）は1つとする。
- 同一エンティティに対し、複数のカテゴリ（軸）を付与することは可能。

### 3.6 割当（SegmentAssignment）は汎用化し、将来の拡張余地を残す
- 割当は entity_kind（対象種別）を enum として保持し、将来の拡張（PO_LINE等）を阻害しない。
- ただし本仕様（MVP）では、割当対象は ITEM / PARTY / SUPPLIER_SITE に限定する。

---

## 4. テナントスコープ
- CategoryAxis / Segment / SegmentAssignment はすべてテナント別（tenant_idあり）とする。
- 物理削除は禁止し、is_active=false による論理無効化を行う。

---

## 5. 対象エンティティ一覧
- CategoryAxis（カテゴリ：軸）
- Segment（セグメント：軸の値）
- SegmentAssignment（割当：エンティティ×軸→値）

---

以上。
